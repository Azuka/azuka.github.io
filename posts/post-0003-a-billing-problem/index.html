<!doctype html><html lang=en-us><head><title>A billing problem based on assumptions - Azuka</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The HTML5 Herald"><meta name=author content="Azuka"><meta property="og:title" content="A billing problem based on assumptions"><meta property="og:description" content="My partner and I started SingleSend a little over a year ago.
Everything we knew about SMS messages was that we had a 160-character limit, so dividing the number of characters in a message by 160 and rounding up would tell us how many messages to bill for. That held true until we got a $750 bill from Twilio last month which didn&rsquo;t quite match the sending statistics we saw."><meta property="og:type" content="article"><meta property="og:url" content="https://azuka.github.io/posts/post-0003-a-billing-problem/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-23T08:38:40-07:00"><meta property="article:modified_time" content="2021-05-23T08:38:40-07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="A billing problem based on assumptions"><meta name=twitter:description content="My partner and I started SingleSend a little over a year ago.
Everything we knew about SMS messages was that we had a 160-character limit, so dividing the number of characters in a message by 160 and rounding up would tell us how many messages to bill for. That held true until we got a $750 bill from Twilio last month which didn&rsquo;t quite match the sending statistics we saw."><meta name=generator content="Hugo 0.108.0"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://azuka.github.io/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=/css/styles.css></head><body><div id=container><header><h1><a href=/>Azuka</a></h1><ul id=social-media><li><a href=https://github.com/Azuka title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://gitlab.com/Azuka title=GitLab><i class="fab fa-gitlab fa-lg"></i></a></li><li><a href=https://twitter.com/zahymaka title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://linkedin.com/in/Azuka title=LinkedIn><i class="fab fa-linkedin fa-lg"></i></a></li><li><a href=https://stackoverflow.com/users/66688/zahymaka title=StackOverflow><i class="fab fa-stack-overflow fa-lg"></i></a></li></ul><p><em>I like to tinker with things</em></p></header><nav><ul><li><a class=active href=/posts/><i class="fa-li fa fa-lg"></i><span>Posts</span></a></li></ul></nav><main><article><h1>A billing problem based on assumptions</h1><aside><ul><li><time class=post-date datetime=2021-05-23T08:38:40-07:00>May 23, 2021</time></li><li><em><a href=/tags/sms>#sms</a></em></li><li>2 minute read</li></ul></aside><p>My partner and I started <a href=https://www.singlesend.com>SingleSend</a> a little over a year ago.</p><p>Everything we knew about SMS messages was that we had a 160-character limit, so dividing the number of characters in
a message by 160 and rounding up would tell us how many messages to bill for. That held true until we got a $750 bill from
Twilio last month which didn&rsquo;t quite match the sending statistics we saw.</p><p>My first thought was malicious actors: I immediately rotated our credentials before taking a look at the logs from Twilio which fortunately, are
quite exhaustive. We found no rogue phone numbers in use, and could trace the SMS IDs back to individual campaign message details in our database.</p><p>Our Twilio bill did mention something called &ldquo;segments&rdquo; which led us to <a href=https://www.twilio.com/blog/2017/03/what-the-heck-is-a-segment.html>Twilio&rsquo;s good post on the subject</a>. The short summary is: most SMS messages use an encoding format called <a href=https://en.wikipedia.org/wiki/GSM_03.38#GSM_7-bit_default_alphabet_and_extension_table_of_3GPP_TS_23.038_/_GSM_03.38>GSM-7</a> for which the 160 characters per message rule <em>mostly</em> holds true: however, once you introduce certain special characters, including emojis, the encoding switches to <a href=https://en.wikipedia.org/wiki/Universal_Coded_Character_Set>UCS-2</a>.</p><p>Twilio has a very convenient <a href=https://twiliodeved.github.io/message-segment-calculator/>segment calculator</a> that helped troubleshoot.</p><p>Here are two sample SMS messages:</p><p><code>Hello, this is a very simple message that should fit into exactly one text. Adding a real :) somehow triples the number of segments, which isn't fun to find out</code></p><p><code>Hello, this is a very simple message that should fit into exactly one text. Adding ðŸ˜­ triples the number of segments: finding that out on your bill is quite fun.</code></p><p>Both have 160 characters, but the second one contains 3 segments while the first has only 1. When you translate that to a 5000-member campaign, the losses weren&rsquo;t pretty. That was a slightly expensive lesson to learn, but it&rsquo;s interesting how assumptions like this don&rsquo;t get noticed until you put in a multiplying factor.</p><p>I&rsquo;ll hopefully tell a story about cloud network transfer costs sometime.</p></article><section class=post-nav><ul><li><a href=https://azuka.github.io/posts/post-0002-that-minor-snafu-with-go-types/><i class="fa fa-chevron-circle-left"></i> That Minor SNAFU With Go Types</a></li><li><a href=https://azuka.github.io/posts/post-0004-fun-with-the-ssh-a-flag/>Fun with php deployer and ssh <i class="fa fa-chevron-circle-right"></i></a></li></ul></section></main><footer><h6>|
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://azuka.github.io/index.xml>Subscribe</a></h6></footer></div><script src=/js/scripts.js></script></body></html>