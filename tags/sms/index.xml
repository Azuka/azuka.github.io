<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Sms on Azuka</title><link>https://azuka.github.io/tags/sms/</link><description>Recent content in Sms on Azuka</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 23 May 2021 08:38:40 -0700</lastBuildDate><atom:link href="https://azuka.github.io/tags/sms/index.xml" rel="self" type="application/rss+xml"/><item><title>At GopherCon</title><link>https://azuka.github.io/posts/post-0005-at-gophercon/</link><pubDate>Thu, 28 Sep 2023 16:00:51 -0700</pubDate><guid>https://azuka.github.io/posts/post-0005-at-gophercon/</guid><description>&lt;p>&amp;ldquo;Sorry, I&amp;rsquo;ll have to drop in 8 minutes&amp;rdquo; I typed into a dedicated Slack channel at work for a group bug fixing session.&lt;/p>&lt;p>I was at &lt;a href="https://www.gophercon.com/">GopherCon&lt;/a>, not quite bright-eyed from a night of wrestling with my hotel&amp;rsquo;sinternet connection, but looking forward to a Keynote talkabout &lt;a href="https://www.gophercon.com/agenda/session/1160910">proposed changes to the encoding/json package&lt;/a>.&lt;/p>&lt;p>I had my badge flipped, because I didn&amp;rsquo;t want to talk to anyone and was in that little zone where I counted the timedown before I had to head back upstairs to the Keynote ballroom.&lt;/p>&lt;p>&amp;ldquo;Are you Azuka?&amp;rdquo;&lt;/p>&lt;p>I looked up to see someone approaching. He didn&amp;rsquo;t look familiar, and for a brief moment I wondered if he was onthe &lt;a href="https://buf.build/">buf&lt;/a> team. I&amp;rsquo;d had a pretty interesting chat the day before about my issuesgetting &lt;a href="https://github.com/connectrpc/connect-es">connect-es&lt;/a> to run in Firebase functionsusing fastify, as well as some typing issues convertingtypescript &lt;a href="https://github.com/bufbuild/protobuf-es/blob/main/docs/runtime_api.md#plainmessage">PlainMessage&lt;/a>representations to Firestore-compatible models. Turns out I was talking to an ex-Googler who worked on Firestore, but Idigress.&lt;/p>&lt;p>&amp;ldquo;Yes I am,&amp;rdquo; I replied, not quite able to place him.&lt;/p>&lt;p>&amp;ldquo;Why did you attack the CTF server on Tuesday?&amp;rdquo;&lt;/p>&lt;p>That came completely out of left-field, because the only response I could muster was &amp;ldquo;huh?&amp;rdquo;&lt;/p>&lt;p>&amp;ldquo;The Capture The Flag event server&amp;rdquo; he continued. &amp;ldquo;You attacked the server and took down the community internet onTuesday.&amp;rdquo;&lt;/p>&lt;p>Whoa. That was a lot to unpack. Surely this was some red team exercise, a prank, or just some guy who was off hisrocker, right?&lt;/p>&lt;p>Right?&lt;/p>&lt;p>Well, no.&lt;/p>&lt;p>&amp;ldquo;What were you doing between 1:30 and 3* Tuesday afternoon?&amp;rdquo; he continued.&lt;/p>&lt;p>&amp;ldquo;Well, I&amp;rsquo;m currently trying to get a containerized application to run on Google Cloud,&amp;rdquo; I explained. &amp;ldquo;I&amp;rsquo;ve been tryingto get it to build but having issues on my Mac M1 due to some of the python scripts somehow not working locally.&amp;rdquo;&lt;/p>&lt;p>&amp;ldquo;I&amp;rsquo;m not a python guy,&amp;rdquo; at this point I was rambling because his expression told me he didn&amp;rsquo;t believe a word I wassaying. &amp;ldquo;It was set up using something called poetry which was taking a long time to solve dependencies and pull pippackages. I eventually started running and troubleshooting on Google Cloud build. Would you like to see?&amp;rdquo;&lt;/p>&lt;p>He did.&lt;/p>&lt;p>I showed him the cloud build timestamps, my git history as well as my local history (thanks Jetbrains / Webstorm). Healso collected the host names of my personal and work MacBooks as well as the ifconfig outputs, possibly to match my MACaddress. He asked if I had another MacBook, but I told him I didn&amp;rsquo;t.&lt;/p>&lt;p>&amp;ldquo;Are you in the Gophers Slack?&amp;rdquo; he asked.&lt;/p>&lt;p>&amp;ldquo;Yes&amp;rdquo; I replied.&lt;/p>&lt;p>&amp;ldquo;Why didn&amp;rsquo;t you respond to the email from H* yesterday?&amp;rdquo; he followed up with another question.&lt;/p>&lt;p>&amp;ldquo;I&amp;rsquo;m not sure I got it,&amp;rdquo; was my response. Who checks work email when not at work?&lt;/p>&lt;p>&amp;ldquo;She sent it to your work email address.&amp;rdquo;&lt;/p>&lt;p>I looked in my inbox, and there it was in the non-focused section:&lt;/p>&lt;p>&amp;ldquo;READ ME: GC23 | Need to Speak to You&amp;rdquo;&lt;/p>&lt;p>Hardly a title that doesn&amp;rsquo;t scream: recruiter.&lt;/p>&lt;p>&amp;ldquo;Oh, it wasn&amp;rsquo;t in the focused section in Outlook,&amp;rdquo; I explained.&lt;/p>&lt;p>&amp;ldquo;Okay,&amp;rdquo; he gave me a non-committal answer. I asked his name, still convinced this wasn&amp;rsquo;t something serious, just so Icould look him up. He walked away, I joined the keynote, and that was it.&lt;/p>&lt;p>Or not.&lt;/p>&lt;p>I looked up both H and our mystery man who I&amp;rsquo;ll call B, and confirmed they were both legitimately associated with theconference, so I replied H via email that I&amp;rsquo;d be happy to talk if she still wanted to. When I looked in the gophersSlack channel, it turned out she had sent me a direct message there as well, so I told her I&amp;rsquo;d replied her email andwould be available if she still wanted to talk.&lt;/p>&lt;p>&amp;ldquo;Yes please. Come see me at the tech table after this talk.&amp;rdquo;&lt;/p>&lt;p>&amp;ldquo;Okay.&amp;rdquo;&lt;/p>&lt;p>Right after the talk, I did. I found B there, and together with H and another guy who looked vaguely familiar, but whoI&amp;rsquo;ll call E, we found a corner to talk.&lt;/p>&lt;p>What it boiled down to was that they knew what I&amp;rsquo;d &amp;ldquo;done&amp;rdquo;, and the docker stuff I said I was doing didn&amp;rsquo;t match thenetwork traffic they saw (&amp;ldquo;I&amp;rdquo;&amp;rsquo;d apparently hit a peak of somewhere around 300mb/s) which drove the internet billsomewhereinto the hundreds of thousands of dollars.&lt;/p>&lt;p>Then came the usual platitudes of &amp;ldquo;everybody makes mistakes&amp;rdquo;, &amp;ldquo;some people have done this before and had to beprosecuted&amp;rdquo;, and &amp;ldquo;you could be banned from attending any other event.&amp;rdquo;&lt;/p>&lt;p>I was flummoxed, and starting to get &lt;em>very&lt;/em> angry. The problem is when I get angry, I get very calm, and the incredulouslooks on their faces told me they were annoyed at how good an actor I was.&lt;/p>&lt;p>E told me so, and B brandished a printed page with the hostname &amp;ldquo;&lt;code>Azukas-MBP&lt;/code>&amp;rdquo; (my hostname is &lt;code>Azukas-Macbook-Pro&lt;/code>) andaMAC address as evidence. According to them , they found me Thursday morning because they could track my MacBook basedon proximity, and it wasn&amp;rsquo;t a mistake that they&amp;rsquo;d tracked me down. H said she wasn&amp;rsquo;t a technical person, but obviouslytrusted them, and after going back and forth pretty much told me to &amp;ldquo;stay in my lane&amp;rdquo; and just not cause trouble for therest of the conference.&lt;/p>&lt;p>At some point, I asked how I could help (network and other logs from my computer, anything) and got the scoffingresponse that none of them had the time to spend on investigating this. I also remembered a prolonged network blipduring the&lt;a href="https://www.gophercon.com/agenda/session/1200016">Service Weaver workshop&lt;/a> within that timeframe where everybody (including me) got stuck downloading go modules (&lt;code>go mod tidy&lt;/code>) but given theattitude I was being given, I wasn&amp;rsquo;t sure about volunteering that information.&lt;/p>&lt;p>I asked what would happen when or if they eventually discovered I wasn&amp;rsquo;t responsible.&lt;/p>&lt;p>&amp;ldquo;We would of course tender an apology, but we&amp;rsquo;re all in the tech space. These things happen, and it could be a mistake,or you were just playing around, but we just need you to come clean. When you look at the fact you didn&amp;rsquo;t reply youremail or the direct Slack message until now, it&amp;rsquo;s hard not to be suspicious.&amp;rdquo;&lt;/p>&lt;p>It was a &amp;ldquo;you know we know that you did it&amp;rdquo; situation. The only person who was absolutely sure I knew nothing about thiswas me, and at 3:1 the odds were just not in my favor.&lt;/p>&lt;p>After another reminder from H to &amp;ldquo;stay in my lane&amp;rdquo;, we broke up and went back in.&lt;/p>&lt;p>I enjoyed the encoding/json v2 proposal talk, but when the keynotes ended, I had some time to reflect on everythingthat transpired and was completely soured on the rest of the conference.&lt;/p>&lt;p>I sent a quick message to my manager at work just in case, and reached out to a few friends.&lt;/p>&lt;p>At this point, I have a lot of questions and no answers.&lt;/p>&lt;ul>&lt;li>Why were they absolutely sure I was responsible for this?&lt;/li>&lt;li>Who actually did it?&lt;/li>&lt;li>How was anyone able to generate that kind of traffic?&lt;/li>&lt;/ul>&lt;p>I understand running a conference is hard, but I hope some time is actually taken to look into this and someone reachesout to me.&lt;/p>&lt;p>I&amp;rsquo;ll wait.&lt;/p>&lt;p>*I may have these times wrong.&lt;/p>&lt;h2 id="post-mortem-update-2023-10-26">Post-mortem (update: 2023-10-26)&lt;/h2>&lt;p>It&amp;rsquo;s been almost a month since this happened. I wrote this down immediately after, because writing has always been myoutlet,but also because I wanted to be sure when I looked back on this in hindsight that my feelings, especially the anger I feltwere justified.&lt;/p>&lt;p>In the meantime, I did some thinking, as well as some snooping. One thing H kept repeating was that by signing up for the conference, I agreed toabide by the code of conduct at GopherCon. I felt blindsided,since this was three people (from my perspective) starting off with accusing me, and attempting to railroad me into admitting to attacking a network server.&lt;/p>&lt;p>At no point was any attempt made to hear my side of the story, other than the beginning accusation by B. I told him about the containers I was building because understandably,that was the only thing I was working on that I believed could increase traffic usage on the network.&lt;/p>&lt;p>First, I went looking for an arbitration process inthe &lt;a href="https://www.gophercon.com/page/2482900/code-of-conduct">GopherCon Code of Conduct&lt;/a>, only to find that it wasexactly a verbatim copy of the&lt;a href="https://go.dev/conduct">Go Community Code of Conduct&lt;/a>, including the email for the Google Open Source Programs Office.I do not believe that Google runs GopherCon so this seemed like there was nothing in place to handle incidents like this, especially give the very unprofessional way I was approached and talked down to.&lt;/p>&lt;p>Looking in the #gophercon-ctf channel in the Gophers Slack workspace, I saw an exchange:&lt;/p>&lt;blockquote>&lt;p>B&lt;/p>&lt;p>2:37 PMSome is attacking &lt;code>https://{redacted}.zip&lt;/code> again&lt;/p>&lt;p>2:37&lt;/p>&lt;p>It&amp;rsquo;s down again&lt;/p>&lt;p>B&lt;/p>&lt;p>2:43 PMBack up&lt;/p>&lt;p>2:43&lt;/p>&lt;p>If anyone identifies who is attacking &lt;code>https://{redacted}.zip&lt;/code> you get 1000 points&lt;/p>&lt;/blockquote>&lt;p>So somewhere in there, someone &amp;ldquo;investigated&amp;rdquo; and got 1000 points.&lt;/p>&lt;p>Additionally, B visited my LinkedIn profile multiple times, although I&amp;rsquo;m not sure why.&lt;/p>&lt;p>The next day, I sent a Slack message to a group chat with B, H, and E, because I wanted to see if there was a neutralthird party who would take a look at what happened, and &lt;strong>&lt;em>listen&lt;/em>&lt;/strong> to me.&lt;/p>&lt;blockquote>&lt;p>Azuka Okuleye11:47 AM&lt;/p>&lt;p>Hello all.&lt;/p>&lt;p>I understand running an event is very stressful, but I gave myself some time to sleep on and think over what happenedyesterday.&lt;/p>&lt;p>This was my very first GopherCon, and I&amp;rsquo;m still very upset at being accused of attacking a server. I hope you have sometime now with everything over, because this is a very serious allegation and I refuse to let this be swept under therug.&lt;/p>&lt;p>I would like to send an email and get this looked into VERY thoroughly because a community is driven not just bysuccesses, but how failures and oversights are handled, and I consider this both. Please let me know who to include.&lt;/p>&lt;p>Thank you.&lt;/p>&lt;/blockquote>&lt;p>Very quickly, I got back a reply:&lt;/p>&lt;blockquote>&lt;p>H12:05 PM&lt;/p>&lt;p>The email would be to us and our stance hasn&amp;rsquo;t changed. We allowed you to stay despite tracking the device to you bothdays.&lt;/p>&lt;/blockquote>&lt;p>which pretty much told me I was not going to get anywhere with them, so I replied with:&lt;/p>&lt;blockquote>&lt;p>Azuka Okuleye12:05 PM&lt;/p>&lt;p>Thank you. That&amp;rsquo;s all I needed to know.&lt;/p>&lt;/blockquote>&lt;p>E followed up with:&lt;/p>&lt;blockquote>&lt;p>E12:33 PM&lt;/p>&lt;p>Azuka, I wholeheartedly agree about the community aspect. That includes following rules that are in place to notdegrade the experience of others.&lt;/p>&lt;p>You weren’t chosen at random. Logs were reviewed, we worked with the hotel’s networking staff as well. The host nameof the machine was your machine. We tracked the MAC address to you. As an IT professional, I’m sure you can agree thatis sufficient evidence to reasonably consider someone a suspect.&lt;/p>&lt;p>You suffered no harm. We approached you, asked you about it, informed you that those types of things won’t betolerated, and let you know the harm that it cost us and the significant networking expenses that we’d be charged. Italso damages our reputation with the venue. They may not let us come back if issues like this are common. Nothing waspublicized, you weren’t asked to leave, it was a warning.&lt;/p>&lt;p>You’re asking for a “VERY thorough” investigation, are you sure you know what you’re asking for? That means workingwith the hotel’s network team further, hiring a third-party security team so that it’s not a conflict, then subpoenaingyour devices to have them forensically audited. That will come at a significant cost to us both financially and in time.If that’s the route we’re taking, it’s because we’re involving the authorities and handling it the legal route.After-all a crime was committed.&lt;/p>&lt;/blockquote>&lt;p>which just left me dumbfounded. I suffered no harm, and I was asked, not harangued about it, where the only acceptableanswer to them would be me admitting to something I didn&amp;rsquo;t do?!&lt;/p>&lt;p>I followed up with:&lt;/p>&lt;blockquote>&lt;p>Azuka Okuleye12:57 PME, I&amp;rsquo;m sure you have a lot of information on your side, and that it&amp;rsquo;s my word against what you have found so far.&lt;/p>&lt;p>I would very likely be inclined to trust it if I were in your position, but I looked in the ctf channel and I know,despite you not believing me, that I did not attack your systems. If, and I know that seems farfetched to you, but ifyou were in my position and had absolutely no idea what was going on, would you take the word of people who havedetermined already that you were responsible? I have been on the other side exactly once in my life, and finding out isstill one of my lowest moments.&lt;/p>&lt;p>Is there even a miniscule chance that I&amp;rsquo;ve been impersonated by someone else? As an IT professional, I&amp;rsquo;m not anetworking person, but even I know that I wouldn&amp;rsquo;t advertise myself using a machine with my name, and that MAC addressescan be spoofed.&lt;/p>&lt;p>Please remember you are dealing with a person here. I left the conference yesterday around 3 after getting off thenetwork as soon as we had our talk, but I stayed in San Diego until late hoping against hope that new information wouldcome up, and this would all turn out to be a mistake.&lt;/p>&lt;p>I offered to help yesterday, and I still stand by that. There&amp;rsquo;s surely some middle ground because my experience here isI answered and provided the information B asked for, and would be happy to provide any additional info.&lt;/p>&lt;p>If the answer is that you &amp;ldquo;let&amp;rdquo; me stay because it would take considerable effort to look into this, I really hope thenext person this happens to gets a better experience than I&amp;rsquo;ve had.&lt;/p>&lt;/blockquote>&lt;p>So far, that conversation has gotten no response, which just confirms my gut feeling that all the parties involved at the other end are interested in is for this to just go away.&lt;/p>&lt;p>This has been handled very poorly, and from what I see, there&amp;rsquo;s little to no accountability here. I think I&amp;rsquo;ve gone above and beyond,and maybe shows that underneath the veneer of &amp;ldquo;community&amp;rdquo;, some people are more equal than others.&lt;/p>&lt;p>I&amp;rsquo;ve gotten a few suggestions, but I&amp;rsquo;ve never liked being the center of attention, so &amp;ldquo;trial by social media&amp;rdquo; is unfortunately not where I want this to go.&lt;/p>&lt;p>If I&amp;rsquo;ve shared this with you, please respect that.&lt;/p>&lt;h2 id="update-and-some-closure-2024-05-05">Update and some closure (2024-05-05)&lt;/h2>&lt;p>A day after I posted the post-mortem update above, I sent an email to the addresses on the &lt;a href="https://go.dev/conduct">Go Community Code of Conduct&lt;/a> page.&lt;/p>&lt;blockquote>&lt;p>Date: Fri, 27 Oct 2023 21:53:54 -0700&lt;br>Subject: GopherCon Complaint&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: &lt;!-- raw HTML omitted -->&lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>, &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>&lt;!-- raw HTML omitted -->&lt;/p>&lt;p>Hello,&lt;/p>&lt;p>I found these emails on the Gophercon code of conduct page:&lt;a href="https://www.gophercon.com/page/2482900/code-of-conduct">https://www.gophercon.com/page/2482900/code-of-conduct&lt;/a>.&lt;/p>&lt;p>Are these the correct places to report a complaint?&lt;/p>&lt;p>Thank you,&lt;br>Azuka Okuleye&lt;/p>&lt;/blockquote>&lt;p>Having received no reply, I sent out another email a month later.&lt;/p>&lt;blockquote>&lt;p>Date: Sat, 25 Nov 2023 09:30:58 -0800&lt;br>Subject: Re: GopherCon Complaint&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>, &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>&lt;/p>&lt;p>Good day,&lt;/p>&lt;p>I wanted to follow up on this email I sent a month ago.&lt;/p>&lt;p>Before I share the details, I wanted confirmation that I&amp;rsquo;m reaching out tothe right channel (s).&lt;/p>&lt;p>Please advise if otherwise.&lt;/p>&lt;p>Thank you.&lt;/p>&lt;p>Azuka Okuleye&lt;/p>&lt;/blockquote>&lt;p>At this point, with yet no reply or confirmation, I went with a formal complaint to the Golang Stewards:&lt;/p>&lt;blockquote>&lt;p>Date: Thu, 30 Nov 2023 07:59:13 -0800&lt;br>Subject: Formal Complaint about GopherCON San Diego October 28 2023&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>&lt;/p>&lt;p>Good day,&lt;/p>&lt;p>I am reaching out to make a complaint about how I was treated at the aboveevent.&lt;/p>&lt;p>On two occasions, I was approached, first by Benji Vesterby, then byHeather Sullivan, Erik St. Martin and Benji Vesterby and accused ofattacking a server used for the Capture the Flag event at the conference. Ihad no idea about any of this, and I believe I was cooperative in providingany information asked of me.&lt;/p>&lt;p>Instead, I was subjected to a very disrespectful huddle where I was talked&lt;em>at&lt;/em>, not to, and the only thing they wanted from me was a confession to acrime I did not commit. Heather in particular kept repeating that I hadagreed to the code of conduct by registering for the conference. I believethat code of conduct goes both ways, especially when the organizers of aconference can make accusations in impunity and refuse any pretense ofinvolving a neutral third party to investigate their claims.&lt;/p>&lt;p>Benji was outright hostile from the very beginning when he walked up to meand accused me of attacking the server, and I&amp;rsquo;m not sure of Erik&amp;rsquo;smotivations when he threatens me with either a criminal investigation, orsweeping this under the rug.&lt;/p>&lt;p>I wrote an account of what happened on my blog an hour later, to ensure Irecollected correctly, which you can find replicated below at the end ofthis email: &lt;a href="https://azuka.github.io/posts/post-0005-at-gophercon/">https://azuka.github.io/posts/post-0005-at-gophercon/&lt;/a>. I haveattached relevant screenshots from Slack, including when I reached out toall three people mentioned above.&lt;/p>&lt;p>I would greatly appreciate a confirmation that this email has beenreceived, even if no immediate action is taken.&lt;/p>&lt;p>Sincerely,&lt;/p>&lt;p>Azuka Okuleye&lt;/p>&lt;p>xxx-xxx-xxxx (text-only please, if you need to reach me).&lt;/p>&lt;p>&lt;a href="https://www.linkedin.com/in/azuka">https://www.linkedin.com/in/azuka&lt;/a>&lt;/p>&lt;hr>&lt;p>&amp;lt; everything below here was just copy pasting my entire post before this section &amp;gt;&lt;/p>&lt;/blockquote>&lt;p>Even that got me no reply, so I forwarded to the Google Open Source email address&lt;/p>&lt;blockquote>&lt;p>Date: Thu, 30 Nov 2023 08:01:17 -0800&lt;br>Subject: Fwd: Formal Complaint about GopherCON San Diego October 28 2023&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>&lt;/p>&lt;p>Good day,&lt;/p>&lt;p>I hope this finds you well.&lt;/p>&lt;p>I submitted a formal complaint to the Golang Stewards, which you can findbelow.&lt;/p>&lt;p>Sincerely,&lt;/p>&lt;p>Azuka Okuleye&lt;/p>&lt;p>&amp;mdash;&amp;mdash;&amp;mdash;- Forwarded message &amp;mdash;&amp;mdash;&amp;mdash;&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>Date: Thu, Nov 30, 2023, 7:59 AM&lt;br>Subject: Formal Complaint about GopherCON San Diego October 28 2023&lt;br>To: &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>&lt;/p>&lt;p>&amp;lt; etc, etc &amp;gt;&lt;/p>&lt;/blockquote>&lt;p>This time I got a response:&lt;/p>&lt;blockquote>&lt;p>From: Russ Cox &amp;lt;redacted_google.com&amp;gt;&lt;br>Date: Mon, 4 Dec 2023 12:43:08 -0500&lt;br>Subject: conduct report re GopherCon&lt;br>To: &amp;lt;redacted&amp;gt;&lt;/p>&lt;p>Hi Azuka,&lt;/p>&lt;p>Thank you for reaching out to both &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a> and&lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>. I wanted to let you know that we received your mail.There was in fact a problem with the &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a> alias forwardingthat we&amp;rsquo;ve now resolved, so thanks for pinging opensource@ too. I&amp;rsquo;m notsure whether I&amp;rsquo;ll be able to say anything more, but we did receive themessage, and I intend to talk to the GopherCon organizers to learn moreabout the situation. Thanks again.&lt;/p>&lt;p>Best,&lt;br>Russ&lt;/p>&lt;/blockquote>&lt;p>to which I sent a reply.&lt;/p>&lt;blockquote>&lt;p>Date: Mon, 4 Dec 2023 09:45:39 -0800&lt;br>Subject: Re: conduct report re GopherCon&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: Russ Cox &amp;lt;redacted_google.com&amp;gt;&lt;/p>&lt;p>Hi Russ,&lt;/p>&lt;p>Thank you very much for getting back to me and I appreciate your lookinginto this.&lt;/p>&lt;p>Best,&lt;br>Azuka&lt;/p>&lt;/blockquote>&lt;p>Then I waited.&lt;/p>&lt;p>And waited.&lt;/p>&lt;p>And waited&amp;hellip;&lt;/p>&lt;p>One thing I knew would happen is the GopherCon code of conduct had to change. There was no way Google, or the Golangstewards wouldwant people bringing complaints about a conference they did not directly control to them.I checked weekly, sometimes twice a week, and it did change, so I got optimistic.&lt;/p>&lt;p>I waited three months after my complaint without hearing anything back. In the meantime, I looked at the email on the code of conduct,which pointed to Gopher Academy. Given thatthe &lt;a href="https://search.sunbiz.org/Inquiry/corporationsearch/SearchResultDetail?inquirytype=EntityName&amp;amp;directionType=ForwardList&amp;amp;searchNameOrder=GOPHERACADEMY%20L130000709560&amp;amp;aggregateId=flal-l13000070956-b1f58cf5-8538-4293-9c3c-f040ef19524e&amp;amp;searchTerm=GOPALA%20INC.&amp;amp;listNameOrder=GOPHERACADEMY%20L130000709560">registration&lt;/a>,pointed to Erik St. Martin who also (presumably) ownsthe &lt;a href="https://github.com/gopheracademy">gopheracademy GitHub organization&lt;/a>, I had zero confidence actually following thatwould yield any useful results.&lt;/p>&lt;p>On March 1st, I sent a follow-up email.&lt;/p>&lt;blockquote>&lt;p>Date: Fri, 1 Mar 2024 13:57:09 -0800&lt;br>Subject: Re: Formal Complaint about GopherCON San Diego October 28 2023&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>, &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>&lt;/p>&lt;p>Hello,&lt;/p>&lt;p>I would like to follow up on the status of my complaint.&lt;/p>&lt;p>I understand you may not be at liberty to share the details, but could youlet me know if this is still in progress or if you&amp;rsquo;ve come to a resolution?&lt;/p>&lt;p>Thank you,&lt;/p>&lt;p>Azuka Okuleye&lt;/p>&lt;/blockquote>&lt;p>Which got me nothing.&lt;/p>&lt;p>On March 20, I sent a follow-up email to Russ Cox, and got an out of office auto-reply stating he was out until March 26th.&lt;/p>&lt;blockquote>&lt;p>Date: Wed, 20 Mar 2024 08:04:21 -0700&lt;br>Subject: Re: conduct report re GopherCon&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: Russ Cox &amp;lt;redacted_google.com&amp;gt;&lt;/p>&lt;p>Hi Russ,&lt;/p>&lt;p>Sorry if I&amp;rsquo;m bugging you but I just wanted to check back in with you.&lt;/p>&lt;p>I sent a follow-up email to both &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a> and&lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a> but didn&amp;rsquo;t hear back and wanted to confirm if this isstill ongoing or if there&amp;rsquo;s been a conclusion: understanding, of coursethat it may not be shared with me.&lt;/p>&lt;p>Thank you,&lt;br>Azuka&lt;/p>&lt;/blockquote>&lt;p>April came around and nothing happened. I had traveled to Chicago for work, and part of that involved containerizing anapplication while working out dependencies to ensure it could run locally on my work Mac M1s, as well as the Linux AMD64 machines our Kubernetes nodes used.This was almost exactly the same kind of problem I was working on when I got accused.&lt;/p>&lt;p>I was done being patient, and I wanted this done and gone, so I sent an email.&lt;/p>&lt;blockquote>&lt;p>Date: Fri, 19 Apr 2024 08:05:44 -0700&lt;br>Subject: Re: Formal Complaint about GopherCON San Diego October 28 2023&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>, &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>&lt;/p>&lt;p>Good day,&lt;/p>&lt;p>I&amp;rsquo;m pretty frustrated that I&amp;rsquo;ve heard nothing back after the initialacknowledgement from Russ Cox.&lt;/p>&lt;p>Are these emails working? What do I have to do to get a reply?&lt;/p>&lt;p>Azuka Okuleye&lt;/p>&lt;/blockquote>&lt;p>My reply came in almost an hour later, which I didn&amp;rsquo;t get to reply until I was on the plane headed home.&lt;/p>&lt;blockquote>&lt;p>From: Russ Cox &amp;lt;redacted_google.com&amp;gt;&lt;br>Date: Fri, 19 Apr 2024 12:10:24 -0400&lt;br>Subject: Re: [conduct] Re: Formal Complaint about GopherCON San Diego October28 2023&lt;br>To: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>Cc: &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>, &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>&lt;/p>&lt;p>Hi Azuka,&lt;/p>&lt;p>Apologies for not getting back to you earlier. I started to reply a fewtimes but always got interrupted.&lt;/p>&lt;p>I checked in with the organizers, and they shared their point of view andhow the events unfolded from their point of view during the conference. Ingeneral these kinds of situations are difficult to handle well, and it&amp;rsquo;snot uncommon for both sides to feel frustrated with the other side. Theorganizers said that they don&amp;rsquo;t have definitive proof that the attack camefrom your laptop, only the traffic stats from the hotel&amp;rsquo;s wifi system,which showed very significantly more traffic from your laptop than anyoneelse&amp;rsquo;s at the conference. That&amp;rsquo;s why they spoke directly to you but did notask you to leave the conference and did not discuss the incident withanyone else. I can also see that from your point of view it feels like anattack to even be accused.&lt;/p>&lt;p>Ultimately I think it is an unfortunate situation but with little more tobe done. The organizers confirmed that you are welcome to attend again.&lt;/p>&lt;p>I would suggest installing a macOS network traffic monitor such as LittleSnitch so that you have more visibility into what your machine is doing onthe network. It is possible there was a runaway program doing somethingthat caused all the trouble. More visibility is always a good thing.&lt;/p>&lt;p>Best,&lt;br>Russ&lt;/p>&lt;/blockquote>&lt;p>Honestly, I was very disappointed by the reply. There&amp;rsquo;s a &lt;em>very&lt;/em> big difference between &amp;ldquo;We noticed a lot of trafficcoming from your laptop&amp;rdquo; and &amp;ldquo;You attacked our server&amp;rdquo;, especially when I shared willingly that I&amp;rsquo;d been trying over andover to build an almost 20gb Dockerfile locally, and running into issues.&lt;/p>&lt;p>I had a very sarcastic reply typed up almost immediately in Google Keep (for carthasis, I guess), but ultimately sent this out:&lt;/p>&lt;blockquote>&lt;p>Date: Fri, 19 Apr 2024 18:08:44 -0500&lt;br>Subject: Re: [conduct] Re: Formal Complaint about GopherCON San Diego October28 2023&lt;br>From: Azuka Okuleye &amp;lt;redacted&amp;gt;&lt;br>To: Russ Cox &amp;lt;redacted_google.com&amp;gt;&lt;br>Cc: &lt;a href="mailto:opensource@google.com">opensource@google.com&lt;/a>, &lt;a href="mailto:conduct@golang.org">conduct@golang.org&lt;/a>&lt;/p>&lt;p>Hi Russ,&lt;/p>&lt;p>Thanks for getting back to me. I&amp;rsquo;m currently in the middle of traveling soI may be brief.&lt;/p>&lt;p>I speak very confidently when I say there were better ways to handle this.&lt;/p>&lt;p>From the very beginning when Benji walked up to me with an accusation, towhen I later met with Erik and Heather, I was completely on the defensive.&lt;/p>&lt;p>I dare say any one else in my situation would have frozen up (which I did).I was given no proof or any information: just told to admit to what I did.The implication was that since I did not reply my work email (if only theystopped to consider I was at a conference and away from work) or gopherSlack (which I&amp;rsquo;m not active on in the first place), then I had something tohide. I was cooperative, I told them what I&amp;rsquo;d been working on, even thoughit&amp;rsquo;s side work that could have gotten me in trouble at my job, I offered mylaptop to do any additional digging.&lt;/p>&lt;p>Nobody&amp;rsquo;s a villain in their own story, and I&amp;rsquo;m sure we all believe we didthe best under the circumstances.&lt;/p>&lt;p>Thank you again for bringing this to a conclusion, although not the one Iwanted, but you don&amp;rsquo;t always get what you want in life. An apology (notfrom you) would have sufficed.&lt;/p>&lt;p>I don&amp;rsquo;t think I&amp;rsquo;ll be returning to gopherCon unless I&amp;rsquo;m mandated to atwork, because as I&amp;rsquo;ve mentioned before, the handling of this by theorganizers and the way I was spoken to will not make me comfortableattending.&lt;/p>&lt;p>All the best.&lt;/p>&lt;p>Azuka&lt;/p>&lt;/blockquote>&lt;p>Well, this is where it all ends, and all these people, as well as GopherCon, can stop living rent-free in my head.&lt;/p>&lt;p>Oh, and here&amp;rsquo;s the docker file that &amp;ldquo;attacked&amp;rdquo; the precious CTF server, because I&amp;rsquo;m still not buying that nonsense:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;lt;Azuka&amp;gt;: Where I got stuck because it was initially running on a machine with a gpu&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#FROM tensorflow/tensorflow:2.4.1-gpu&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">FROM&lt;/span>&lt;span style="color:#e6db74"> tensorflow/tensorflow:2.13.0&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#FROM --platform=linux/x86_64 tensorflow/tensorflow:2.13.0&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">WORKDIR&lt;/span>&lt;span style="color:#e6db74"> /app&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">VOLUME&lt;/span>&lt;span style="color:#e6db74"> /database&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">VOLUME&lt;/span>&lt;span style="color:#e6db74"> /input&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">VOLUME&lt;/span>&lt;span style="color:#e6db74"> /logs&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># &amp;lt;Azuka&amp;gt;: GPG problems when building the image from scratch&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># https://github.com/tensorflow/tensorflow/issues/56085&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/3bf863cc.pub&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># Install system requirements.&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> apt-get update &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> apt-get upgrade -y &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> apt-get install -y &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> git &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> libfontconfig &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> fontconfig &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> libjpeg-turbo8 &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> libxrender1 &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> xfonts-75dpi &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> xvfb &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> wget &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> rm -rf /var/lib/apt/lists/*&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># We build wkhtmltox ourselves to include patched QT.&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/deps ./deps&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> dpkg -i ./deps/wkhtmltox_0.12.5-1.bionic_amd64.deb&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># Copy large binary file requirements early to take advantage of Docker layer&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># caching.&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/bin ./bin&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># &amp;lt;Azuka&amp;gt;: Everything here before dumb-init was me fighting python deps. I&amp;#39;m not a python guy&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># Install poetry&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> pip install --upgrade pip&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> python3 -m pip install --upgrade pip&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> pip install poetry&lt;span style="color:#f92672">==&lt;/span>1.1.15&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> poetry config virtualenvs.create false&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/pyproject.toml ./pyproject.toml&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> rm -rfv &lt;span style="color:#66d9ef">$(&lt;/span>poetry config virtualenvs.path&lt;span style="color:#66d9ef">)&lt;/span>/*&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#RUN poetry export --no-dev -f requirements.txt --output requirements.txt&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#RUN pip install -r requirements.txt&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> poetry install --no-dev -vvv&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> poetry run pip install --find-links&lt;span style="color:#f92672">=&lt;/span>deps torchvision&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#RUN python3 -m spacy download en_core_web_trf&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#RUN python3 -m spacy download en_core_web_sm&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># # Install python requirements with pipenv&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># #RUN pip install setuptools --upgrade&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># RUN pip install --upgrade pip&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># RUN pip install pipenv&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># #COPY backend/pyproject.toml ./pyproject.toml&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># COPY backend/Pipfile .&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># # We reuse tensorflow already installed in the base Docker image.&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># RUN sed -i &amp;#39;/tensorflow\ =/d&amp;#39; ./Pipfile&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># RUN pipenv install&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># #RUN python3 -m pipenv sync --deploy --system&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># RUN pip install --find-links=deps torchvision&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> python3 -m spacy download en_core_web_trf&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#RUN python3 -m spacy download en_core_web_sm&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> pip install psycopg2-binary pyparsing&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> wget -O /usr/local/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_x86_64&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> chmod +x /usr/local/bin/dumb-init&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">ENTRYPOINT&lt;/span> [&lt;span style="color:#e6db74">&amp;#34;/usr/local/bin/dumb-init&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;-v&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;--&amp;#34;&lt;/span>]&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># We copy individual folders to preserve directory structure.&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/README.md ./README.md&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/report_templates ./report_templates&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/runtime ./runtime&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#COPY backend/bin ./bin&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/lib ./lib&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/config ./config&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#COPY backend/rad_parser ./rad_parser&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> backend/app.py .&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">COPY&lt;/span> types/app-report.schema.json ../types/app-report.schema.json&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">ENV&lt;/span> ENV&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;dev-docker&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#ENTRYPOINT [&amp;#34;python3&amp;#34;, &amp;#34;app.py&amp;#34;]&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">CMD&lt;/span> [&lt;span style="color:#e6db74">&amp;#34;python&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;app.py&amp;#34;&lt;/span>]&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#CMD [&amp;#34;python3&amp;#34;, &amp;#34;-m&amp;#34;, &amp;#34;pipenv&amp;#34;, &amp;#34;run&amp;#34;, &amp;#34;python&amp;#34;, &amp;#34;app.py&amp;#34;]&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e">#CMD [&amp;#34;python3&amp;#34;, &amp;#34;-m&amp;#34;, &amp;#34;trace&amp;#34;, &amp;#34;--trace&amp;#34;, &amp;#34;app.py&amp;#34;]&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Fun with php deployer and ssh</title><link>https://azuka.github.io/posts/post-0004-fun-with-the-ssh-a-flag/</link><pubDate>Mon, 19 Dec 2022 23:37:38 -0800</pubDate><guid>https://azuka.github.io/posts/post-0004-fun-with-the-ssh-a-flag/</guid><description>&lt;p>A long, long time ago when my daily driver was a Windows machine,I used to deploy websites over ftp, then sftp. I remember SmartFTP being one of the firstsoftware tools I ever purchased.&lt;/p>&lt;p>In time (around 2011), I got introduced to &lt;a href="https://capistranorb.com/">Capistrano&lt;/a> when I started doing continuous integration/delivery and setting up multiple environments for my projects.&lt;/p>&lt;p>Getting a consistent ruby ecosystem working for mostly php projects was annoying as I moved between Jenkins, Wercker (pre-Oracle), Shippable (before they got acquired by JFrog) and finally CircleCI. I did have Ruby dependencies because &lt;a href="https://github.com/Compass/compass">Compass&lt;/a> was all the rage, but eventually, it became annoying as browsers stopped needing prefixes, and Sass got ported to other languages.&lt;/p>&lt;p>I started doing deploys somewhat like this:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$BRANCH&lt;span style="color:#e6db74">&amp;#34;&lt;/span> !&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;master&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span> ssh -t $DEPLOY_USER@$DEPLOY_HOST &lt;span style="color:#e6db74">&amp;#34;cd ~/app_staging &amp;amp;&amp;amp; git fetch --all &amp;amp;&amp;amp; git checkout --force &lt;/span>$COMMIT&lt;span style="color:#e6db74"> &amp;amp;&amp;amp; php composer.phar install --no-dev --optimize-autoloader&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> grunt; curl -H &lt;span style="color:#e6db74">&amp;#34;x-api-key:xxxx&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[app_name]=App-other&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[description]=This deployment can be viewed at &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>BUILD_URL&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[revision]=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>COMMIT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[changelog]=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>SHIPPABLE_BUILD_ID&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[user]=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>USER&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> https://api.newrelic.com/deployments.xml; &lt;span style="color:#66d9ef">fi&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$BRANCH&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;master&amp;#34;&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span> ssh -t $DEPLOY_USER@$DEPLOY_HOST &lt;span style="color:#e6db74">&amp;#34;cd ~/app_system &amp;amp;&amp;amp; git fetch --all &amp;amp;&amp;amp; git checkout --force &lt;/span>$COMMIT&lt;span style="color:#e6db74"> &amp;amp;&amp;amp; php composer.phar install --no-dev --optimize-autoloader&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> grunt; curl -H &lt;span style="color:#e6db74">&amp;#34;x-api-key:xxxx&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[app_name]=App-production&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[description]=This deployment can be viewed at &lt;/span>&lt;span style="color:#e6db74">${&lt;/span>BUILD_URL&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[revision]=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>COMMIT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[changelog]=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>SHIPPABLE_BUILD_ID&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -d &lt;span style="color:#e6db74">&amp;#34;deployment[user]=&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>USER&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> https://api.newrelic.com/deployments.xml; &lt;span style="color:#66d9ef">fi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I missed capistrano multistage though, because there was no easy way to roll back deployments other than manually, and on projects where I had to deploy to multiple servers, this became unwieldy very quickly.&lt;/p>&lt;p>Enter &lt;a href="https://deployer.org">deployer&lt;/a>.&lt;/p>&lt;p>It had an API that reminded me of Capistrano: multiple hosts and stages, with support for custom tasks and symlinked releases that didn&amp;rsquo;t get swapped until deployment completion.&lt;/p>&lt;p>I started at v3 and have gone through 4 major version upgrades with &lt;a href="https://github.com/deployphp/deployer/pull/1160">some&lt;/a> &lt;a href="https://github.com/deployphp/deployer/issues/1156">battle&lt;/a> &lt;a href="https://github.com/deployphp/deployer/issues/3337">scars&lt;/a> to show.&lt;/p>&lt;p>The latest one was a simple task definition which I used to keep secrets pulled from a separate repo (admittedly not a very good idea, but one that works for now):&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">task&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;env:secrets&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span> () {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">run&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;(cd ~/.env-secrets &amp;amp;&amp;amp; git pull)&amp;#39;&lt;/span>);&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">desc&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Pull secret files.&amp;#39;&lt;/span>);&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I kept getting a fatal pull error even though I could ssh into all the affected servers and literally run &lt;code>(cd ~/.env-secrets &amp;amp;&amp;amp; git pull)&lt;/code> without any problems. I could also run the deploy command locally without any issues, ie:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>./vendor/bin/dep env:secrets stage&lt;span style="color:#f92672">=&lt;/span>staging --revision&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>git rev-parse HEAD&lt;span style="color:#66d9ef">)&lt;/span> -vvv&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Using CircleCI&amp;rsquo;s ssh mode to troubleshoot got me nothing. Cue the dreaded list of CI git commits a la &lt;code>try deploy x16&lt;/code>.&lt;/p>&lt;p>I fix CI systems at work quite a bit, and in almost every case, the problem is right there in the terminal output, so it was quite ironic when I took a closer look and saw:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ssh &lt;span style="color:#e6db74">&amp;#39;-F&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;/home/circleci/.ssh/config&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;-A&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;-o&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;ControlMaster=auto&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;-o&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;ControlPersist=60&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;-o&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;ControlPath=/dev/shm/***@****&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;***@****&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;: 34bf7dc0417ecfc06846; bash -ls&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Using those ssh args, and running a git pull, I got the expected fatal error: bingo!&lt;/p>&lt;p>After reading the &lt;em>fine&lt;/em> manual and narrowing the culprit to &lt;a href="https://superuser.com/questions/1376111/with-ssh-what-does-the-a-flag-do">the -A flag&lt;/a>, it was as simple as updating the task to:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">task&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;env:secrets&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span> () {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">run&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;SSH_AUTH_SOCK=&amp;#34;&amp;#34; (cd ~/.env-secrets &amp;amp;&amp;amp; git pull)&amp;#39;&lt;/span>);&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">desc&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Pull secret files.&amp;#39;&lt;/span>);&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Deployer does have a &lt;code>-&amp;gt;setForwardAgent(false)&lt;/code> host flag, but 4 major upgrades have taught me not to mess too much with the internals when they &lt;em>just&lt;/em> work.&lt;/p>&lt;p>As always, it&amp;rsquo;s the little things that cost you hours of debugging, especially when your internet is spotty.&lt;/p></description></item><item><title>A billing problem based on assumptions</title><link>https://azuka.github.io/posts/post-0003-a-billing-problem/</link><pubDate>Sun, 23 May 2021 08:38:40 -0700</pubDate><guid>https://azuka.github.io/posts/post-0003-a-billing-problem/</guid><description>&lt;p>My partner and I started &lt;a href="https://www.singlesend.com">SingleSend&lt;/a> a little over a year ago.&lt;/p>&lt;p>Everything we knew about SMS messages was that we had a 160-character limit, so dividing the number of characters ina message by 160 and rounding up would tell us how many messages to bill for. That held true until we got a $750 bill fromTwilio last month which didn&amp;rsquo;t quite match the sending statistics we saw.&lt;/p>&lt;p>My first thought was malicious actors: I immediately rotated our credentials before taking a look at the logs from Twilio which fortunately, arequite exhaustive. We found no rogue phone numbers in use, and could trace the SMS IDs back to individual campaign message details in our database.&lt;/p>&lt;p>Our Twilio bill did mention something called &amp;ldquo;segments&amp;rdquo; which led us to &lt;a href="https://www.twilio.com/blog/2017/03/what-the-heck-is-a-segment.html">Twilio&amp;rsquo;s good post on the subject&lt;/a>. The short summary is: most SMS messages use an encoding format called &lt;a href="https://en.wikipedia.org/wiki/GSM_03.38#GSM_7-bit_default_alphabet_and_extension_table_of_3GPP_TS_23.038_/_GSM_03.38">GSM-7&lt;/a> for which the 160 characters per message rule &lt;em>mostly&lt;/em> holds true: however, once you introduce certain special characters, including emojis, the encoding switches to &lt;a href="https://en.wikipedia.org/wiki/Universal_Coded_Character_Set">UCS-2&lt;/a>.&lt;/p>&lt;p>Twilio has a very convenient &lt;a href="https://twiliodeved.github.io/message-segment-calculator/">segment calculator&lt;/a> that helped troubleshoot.&lt;/p>&lt;p>Here are two sample SMS messages:&lt;/p>&lt;p>&lt;code>Hello, this is a very simple message that should fit into exactly one text. Adding a real :) somehow triples the number of segments, which isn't fun to find out&lt;/code>&lt;/p>&lt;p>&lt;code>Hello, this is a very simple message that should fit into exactly one text. Adding 😭 triples the number of segments: finding that out on your bill is quite fun.&lt;/code>&lt;/p>&lt;p>Both have 160 characters, but the second one contains 3 segments while the first has only 1. When you translate that to a 5000-member campaign, the losses weren&amp;rsquo;t pretty. That was a slightly expensive lesson to learn, but it&amp;rsquo;s interesting how assumptions like this don&amp;rsquo;t get noticed until you put in a multiplying factor.&lt;/p>&lt;p>I&amp;rsquo;ll hopefully tell a story about cloud network transfer costs sometime.&lt;/p></description></item><item><title>That Minor SNAFU With Go Types</title><link>https://azuka.github.io/posts/post-0002-that-minor-snafu-with-go-types/</link><pubDate>Fri, 28 Feb 2020 09:42:14 -0800</pubDate><guid>https://azuka.github.io/posts/post-0002-that-minor-snafu-with-go-types/</guid><description>&lt;p>Today&amp;rsquo;s specimen:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">expectedError&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">error&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">expectedError&lt;/span>) &lt;span style="color:#a6e22e">Cause&lt;/span>() &lt;span style="color:#66d9ef">error&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">e&lt;/span>.&lt;span style="color:#66d9ef">error&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">IsExpectedError&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#66d9ef">error&lt;/span>) &lt;span style="color:#66d9ef">bool&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span>.(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">expectedError&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">ok&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In one of my projects, I&amp;rsquo;m using &lt;a href="https://link.medium.com/rzNnWtY6r4">consul for distributed locking&lt;/a>, to preventprocessing an item twice from a queue worker.&lt;/p>&lt;p>My implementation looked something like the below:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> (&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;context&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;github.com/hashicorp/consul/api&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;github.com/pkg/errors&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;os&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;time&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">lock&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">db&lt;/span> &lt;span style="color:#a6e22e">datasource&lt;/span>.&lt;span style="color:#a6e22e">LockStore&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">consul&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">api&lt;/span>.&lt;span style="color:#a6e22e">Client&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">l&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">lock&lt;/span>) &lt;span style="color:#a6e22e">AcquireLock&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span> &lt;span style="color:#a6e22e">context&lt;/span>.&lt;span style="color:#a6e22e">Context&lt;/span>, &lt;span style="color:#a6e22e">action&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">f&lt;/span> &lt;span style="color:#66d9ef">func&lt;/span>() &lt;span style="color:#66d9ef">error&lt;/span>) &lt;span style="color:#66d9ef">error&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">lck&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>.&lt;span style="color:#a6e22e">db&lt;/span>.&lt;span style="color:#a6e22e">GetLock&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span>, &lt;span style="color:#a6e22e">action&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">Wrap&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;unable to query database for lock&amp;#34;&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">lck&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">expectedError&lt;/span>{&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">Errorf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;item %s already processed at %s&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">action&lt;/span>, &lt;span style="color:#a6e22e">lck&lt;/span>.&lt;span style="color:#a6e22e">CreatedAt&lt;/span>.&lt;span style="color:#a6e22e">Format&lt;/span>(&lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">RFC3339&lt;/span>)),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">lck&lt;/span> = &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">models&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>{&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">Action&lt;/span>: &lt;span style="color:#a6e22e">action&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// nolint&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">hn&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">os&lt;/span>.&lt;span style="color:#a6e22e">Hostname&lt;/span>()&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">opts&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">api&lt;/span>.&lt;span style="color:#a6e22e">LockOptions&lt;/span>{&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">Key&lt;/span>: &lt;span style="color:#a6e22e">lck&lt;/span>.&lt;span style="color:#a6e22e">Action&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">Value&lt;/span>: []byte(&lt;span style="color:#e6db74">&amp;#34;set by &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">hn&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">SessionTTL&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;120s&amp;#34;&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">LockWaitTime&lt;/span>: &lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">Second&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">cLck&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>.&lt;span style="color:#a6e22e">consul&lt;/span>.&lt;span style="color:#a6e22e">LockOpts&lt;/span>(&lt;span style="color:#a6e22e">opts&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">WithStack&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> = &lt;span style="color:#a6e22e">cLck&lt;/span>.&lt;span style="color:#a6e22e">Lock&lt;/span>(&lt;span style="color:#66d9ef">nil&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">WithStack&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#66d9ef">func&lt;/span>() {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">_&lt;/span> = &lt;span style="color:#a6e22e">cLck&lt;/span>.&lt;span style="color:#a6e22e">Unlock&lt;/span>()&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}()&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> = &lt;span style="color:#a6e22e">f&lt;/span>(); &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">WithStack&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">expectedError&lt;/span>{&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">errors&lt;/span>.&lt;span style="color:#a6e22e">Wrapf&lt;/span>(&lt;span style="color:#a6e22e">l&lt;/span>.&lt;span style="color:#a6e22e">db&lt;/span>.&lt;span style="color:#a6e22e">CreateLock&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span>, &lt;span style="color:#a6e22e">lck&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;unable to save lock to database for %s at %s&amp;#34;&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">lck&lt;/span>.&lt;span style="color:#a6e22e">Action&lt;/span>, &lt;span style="color:#a6e22e">lck&lt;/span>.&lt;span style="color:#a6e22e">CreatedAt&lt;/span>.&lt;span style="color:#a6e22e">Format&lt;/span>(&lt;span style="color:#a6e22e">time&lt;/span>.&lt;span style="color:#a6e22e">RFC3339&lt;/span>))&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What could go wrong? Everything.&lt;/p>&lt;p>Something like&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Process message in a lock&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">err&lt;/span> = &lt;span style="color:#a6e22e">w&lt;/span>.&lt;span style="color:#a6e22e">lock&lt;/span>.&lt;span style="color:#a6e22e">AcquireLock&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span>, &lt;span style="color:#a6e22e">action&lt;/span>, &lt;span style="color:#66d9ef">func&lt;/span>() &lt;span style="color:#66d9ef">error&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">w&lt;/span>.&lt;span style="color:#a6e22e">sendMessage&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span>, &lt;span style="color:#a6e22e">m&lt;/span>, &lt;span style="color:#a6e22e">accountName&lt;/span>)&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// This detects a lock-only error and uses that&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">locking&lt;/span>.&lt;span style="color:#a6e22e">IsExpectedError&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span>) {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">doSomething&lt;/span>()&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>would never execute &lt;code>doSomething()&lt;/code>, even if &lt;code>sendMessage()&lt;/code> succeeds, because I decided to be lazy and wrap the result of &lt;code>CreateLock()&lt;/code> without checking for a non-nil error.&lt;/p>&lt;p>Tiny bug, annoying to troubleshoot, until I wrote tests, which makes me wonder why I didn&amp;rsquo;t write any in the first place.&lt;/p></description></item><item><title>A Poor Guy's Local PHP Apm</title><link>https://azuka.github.io/posts/post-0001-a-poor-guys-apm/</link><pubDate>Wed, 18 Dec 2019 07:58:36 -0800</pubDate><guid>https://azuka.github.io/posts/post-0001-a-poor-guys-apm/</guid><description>&lt;p>I&amp;rsquo;ve seen the benefits of instrumenting code for a very long time: with PHP, Go, Frontend Javascript, and more recently, NodeJS.&lt;/p>&lt;p>When you have access to a full APM solution like I do at work (Newrelic), or on the side (with &lt;a href="https://www.elastic.co/products/apm">Elastic APM&lt;/a>), it becomes easy to see at a glance not only what transactions (API calls, queued jobs, asynchronous processes, etc) are taking a long time, but also &lt;em>why&lt;/em>.&lt;/p>&lt;p>I ran into a situation where one of &lt;a href="https://www.congregateonline.com/">my first projects&lt;/a> experienced a bottleneckwith slow page loads. In Newrelic Lite (the free forever plan), I could tell that on average, we were makingselect queries on a table over a 100 times per page load on average. Most of this code was written in 2010(my excuse, although not a very good one), and at a glance it wasn&amp;rsquo;t easy to tell &lt;em>where&lt;/em> exactly the problem was, although I knew what it was: &lt;a href="https://www.mehdi-khalili.com/orm-anti-patterns-part-3-lazy-loading">ORM lazy loading in a loop&lt;/a>.&lt;/p>&lt;p>Upgrading to the a pricier version of Newrelic was not an option. I had a local version of the application working with docker-compose: was there perhaps a solution I could run locally, while pinpointing the exact problem? There had to be.&lt;/p>&lt;p>I tried:&lt;/p>&lt;ul>&lt;li>&lt;strong>XDebug&lt;/strong>. The holy grail. Grind viewers were less than helpful getting an exact call sequence. Not fun.&lt;/li>&lt;li>&lt;strong>PHP APM (&lt;a href="https://pecl.php.net/package/APM">https://pecl.php.net/package/APM&lt;/a>)&lt;/strong>. This hasn&amp;rsquo;t been updated since 2017, fails to build on &lt;a href="https://github.com/patrickallaert/php-apm/issues/73">PHP 7.3&lt;/a>, and I experienced random application crashes on 7.2.&lt;/li>&lt;li>&lt;strong>Pinpoint APM (&lt;a href="https://naver.github.io/pinpoint/">https://naver.github.io/pinpoint/&lt;/a>)&lt;/strong>. Let&amp;rsquo;s just say there was a lot of headscratching, especially around the install. I sort of got it working, but didn&amp;rsquo;t get any useful data. Also, more random crashes.&lt;/li>&lt;/ul>&lt;p>I tried other APM solutions, most of them Saas, but the hurdle was either installing them, the signup/activation process, or the knowledge that I wouldn&amp;rsquo;t be able to reliable diagnose another problem after the trials ran out.&lt;/p>&lt;p>But wait. I&amp;rsquo;d done some work with OpenTracing and OpenCensus before. Could I&amp;hellip;?&lt;/p>&lt;p>&lt;a href="https://github.com/census-instrumentation/opencensus-php">YES!&lt;/a>&lt;/p>&lt;p>I modified my Dockerfile very simply:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-docker" data-lang="docker">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span>&lt;span style="color:#e6db74"> php:7.3-apache&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># Everything else&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> apt-get update &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> apt-get install -y zlib1g-dev libzip-dev zip unzip &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> docker-php-ext-install iconv bcmath zip mysqli opcache pdo pdo_mysql &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">\&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> echo &lt;span style="color:#e6db74">&amp;#34;done!&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75715e"># OpenCensus&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> curl -L https://github.com/census-instrumentation/opencensus-php/archive/master.zip -o opencensus.zip &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> unzip opencensus.zip&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> &lt;span style="color:#f92672">(&lt;/span>cd opencensus-php-*/ext &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> phpize &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ./configure --enable-opencensus &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make test &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> make install&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> docker-php-ext-enable opencensus&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I added both &lt;code>opencensus/opencensus&lt;/code> and &lt;code>opencensus/opencensus-exporter-zipkin&lt;/code> (for &lt;a href="https://www.jaegertracing.io/">Jaeger&lt;/a>) to composer. I didn&amp;rsquo;t use &lt;code>opencensus/opencensus-exporter-jaeger&lt;/code> at the time due to &lt;a href="https://github.com/census-ecosystem/opencensus-php-exporter-jaeger/issues/7">this issue&lt;/a>.&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>composer require --dev &lt;span style="color:#e6db74">&amp;#39;opencensus/opencensus:^0.5.2&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;opencensus/opencensus-exporter-zipkin:^0.1.0&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Followed by changing my docker-compose.yml:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;3.6&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">services&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">build&lt;/span>: &lt;span style="color:#ae81ff">.&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">links&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">db&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#39;7999:80&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">expose&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#39;80&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">.:/var/www/html&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">DB_HOST=db&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">DB_NAME=appdb&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">DB_USER=root&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">DB_PASS=phpapptest&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">DB_PORT=3306&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">KOHANA_ENV=DEVELOPMENT&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">db&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;mariadb:10&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#39;3360:3306&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">./build/phpunit_database.sql:/docker-entrypoint-initdb.d/db.sql&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">./docker/mysql:/var/lib/mysql&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">MYSQL_ROOT_PASSWORD&lt;/span>: &lt;span style="color:#ae81ff">phpapptest&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">MYSQL_DATABASE&lt;/span>: &lt;span style="color:#ae81ff">appdb&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">opencensus&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">jaegertracing/all-in-one:latest&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">COLLECTOR_ZIPKIN_HTTP_PORT&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;9411&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">9400&lt;/span>:&lt;span style="color:#ae81ff">16686&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">9414&lt;/span>:&lt;span style="color:#ae81ff">9411&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">expose&lt;/span>:&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">5775&lt;/span>&lt;span style="color:#ae81ff">/udp&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">6831&lt;/span>&lt;span style="color:#ae81ff">/udp&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">6832&lt;/span>&lt;span style="color:#ae81ff">/udp&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">5778&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">16686&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">14268&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">9411&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>With that, I had the Jaeger endpoint running at &lt;code>http://localhost:9400&lt;/code>&lt;/p>&lt;p>In my application entry point, right after including &lt;code>vendor/autoload.php&lt;/code>, I added the below:&lt;/p>&lt;p>There&amp;rsquo;s some gore in there because we&amp;rsquo;re in the middle of replacing &lt;a href="https://koseven.ga">&lt;del>Kohana&lt;/del> Koseven&lt;/a> with &lt;a href="https://laravel.io">Laravel&lt;/a>.&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Span&lt;/span>;&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Tracer&lt;/span>;&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">use&lt;/span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Exporter\ZipkinExporter&lt;/span>;&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">extension_loaded&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;opencensus&amp;#39;&lt;/span>)) {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Inbuilt instrumentation&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Integrations\Mysql&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">load&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Integrations\PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">load&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Integrations\Eloquent&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">load&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">OpenCensus\Trace\Integrations\Curl&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">load&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Other&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">trim&lt;/span>(&lt;span style="color:#a6e22e">PageManager&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;\\&amp;#39;&lt;/span>), &lt;span style="color:#e6db74">&amp;#39;__construct&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;__construct&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">PageManager&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;get&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $id){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;get&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">compact&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;id&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">PageManager&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;init&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;init&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">PageManager&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;top&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;top&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">PageManager&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;topMenu&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;topMenu&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Views&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_View&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;factory&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $file){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;find_all&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">array_map&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;strval&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">compact&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;file&amp;#39;&lt;/span>)),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_View&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;render&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;render&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Database and ORM&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_ORM&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;find_all&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;find_all&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_ORM&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;find&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;find&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $databaseClasses &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#a6e22e">Kohana_Database&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#a6e22e">Kohana_Database_MySQLi&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#a6e22e">Database_CMySQLi&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">foreach&lt;/span> ($databaseClasses &lt;span style="color:#66d9ef">as&lt;/span> $databaseClass) {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($databaseClass, &lt;span style="color:#e6db74">&amp;#39;query&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $type, $sql){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;query&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> [&lt;span style="color:#e6db74">&amp;#39;query&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> $sql],&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($databaseClass, &lt;span style="color:#e6db74">&amp;#39;begin&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;begin&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($databaseClass, &lt;span style="color:#e6db74">&amp;#39;commit&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;commit&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($databaseClass, &lt;span style="color:#e6db74">&amp;#39;rollback&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;rollback&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Controllers&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> $controllerClasses &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#a6e22e">Kohana_Controller&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#a6e22e">Controller&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#a6e22e">Base_Controller&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">foreach&lt;/span> ($controllerClasses &lt;span style="color:#66d9ef">as&lt;/span> $controllerClass) {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($controllerClass, &lt;span style="color:#e6db74">&amp;#39;__construct&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;__construct&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($controllerClass, &lt;span style="color:#e6db74">&amp;#39;before&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;before&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($controllerClass, &lt;span style="color:#e6db74">&amp;#39;after&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;after&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>($controllerClass, &lt;span style="color:#e6db74">&amp;#39;execute&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;execute&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Controller_Page&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;setup&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;setup&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Request execution and responses&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Request&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;execute&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;execute&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Request_Client&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;execute&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;execute&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Request_Client&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;execute_request&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;execute_request&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Request&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;process&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;process&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Response&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;body&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;body&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Response&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;send_headers&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;send_headers&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Routing&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Route&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;set&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $name){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">array_map&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;strval&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">compact&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>)),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">Kohana_Route&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;cache&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;cache&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Laravel&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\CongreGATEv7\Models\User&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;findForPassport&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;findForPassport&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\CongreGATEv7\Models\User&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;validateForPassportPasswordGrant&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;validateForPassportPasswordGrant&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\CongreGATEv7\Models\User&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;getAuthIdentifierName&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;getAuthIdentifierName&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\Illuminate\Auth\EloquentUserProvider&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;retrieveById&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $identifier){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;retrieveById&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">array_map&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;strval&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">compact&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;identifier&amp;#39;&lt;/span>)),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\Illuminate\Auth\EloquentUserProvider&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;retrieveByToken&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $identifier, $token){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;retrieveByToken&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">array_map&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;strval&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">compact&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;identifier&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;token&amp;#39;&lt;/span>)),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\Illuminate\Auth\EloquentUserProvider&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;updateRememberToken&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $user, $token){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;updateRememberToken&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">array_map&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;strval&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">compact&lt;/span>( &lt;span style="color:#e6db74">&amp;#39;token&amp;#39;&lt;/span>)),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\Illuminate\Auth\EloquentUserProvider&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;retrieveByCredentials&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope, $user, $token){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;retrieveByCredentials&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">opencensus_trace_method&lt;/span>(&lt;span style="color:#a6e22e">\Illuminate\Auth\EloquentUserProvider&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">class&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;validateCredentials&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>($scope){&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">sprintf&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;%s::%s&amp;#39;&lt;/span>, &lt;span style="color:#a6e22e">get_class&lt;/span>($scope), &lt;span style="color:#e6db74">&amp;#39;validateCredentials&amp;#39;&lt;/span>),&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;kind&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">Span&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">KIND_CLIENT&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Tracer&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">start&lt;/span>(&lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">ZipkinExporter&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;congregate&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;http://opencensus:9411/api/v2/spans&amp;#39;&lt;/span>));&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For a case where I needed a stacktrace (calling &lt;code>debug_backtrace()&lt;/code> or &lt;code>debug_print_backtrace()&lt;/code> inside one of the scoped lambda functions above WILL crash the application), I had to do something this ugly:&lt;/p>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">find_all&lt;/span>()&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">extension_loaded&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;opencensus&amp;#39;&lt;/span>)) {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">ob_start&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">debug_print_backtrace&lt;/span>(&lt;span style="color:#a6e22e">DEBUG_BACKTRACE_IGNORE_ARGS&lt;/span>);&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $trace &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">ob_get_clean&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">Tracer&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">inSpan&lt;/span>([&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Model_Page::find_all.instrumented&amp;#39;&lt;/span>,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;attributes&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> [&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#39;trace&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> $trace,&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ], &lt;span style="color:#66d9ef">function&lt;/span>() {&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">parent&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">find_all&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">parent&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#a6e22e">find_all&lt;/span>();&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>A couple days ago, I was told calendar feeds were loading very slowly. All I had to do was look in Newrelic:&lt;/p>&lt;p>&lt;img src="https://azuka.github.io/posts/post1/newrelic-breakdown.png" alt="Newrelic APM Stats">&lt;/p>&lt;p>Not good. Given these relationships:&lt;/p>&lt;pre tabindex="0">&lt;code>Event(belongsTo) EventCategory(hasMany) EventUnavailabilities&lt;/code>&lt;/pre>&lt;p>on average we were querying for events 20 times, categories 57 times, unavailabilities(time ranges to exclude events) &lt;strong>359&lt;/strong> times, and members and families for birthdays and anniversaries on the member calendarroughly 15-20 times on average. NOT GOOD.&lt;/p>&lt;p>Looking locally, I saw this which has a whopping 678 spans:&lt;/p>&lt;p>&lt;img src="https://azuka.github.io/posts/post1/jaeger-take-1.png" alt="Jaeger">&lt;/p>&lt;p>A quick rewrite later, by prefetching, I got this:&lt;/p>&lt;p>&lt;img src="https://azuka.github.io/posts/post1/jaeger-take-2.png" alt="Jaeger">&lt;/p>&lt;p>322 spans, which looks much saner.&lt;/p>&lt;p>Even Newrelic agrees:&lt;/p>&lt;p>&lt;img src="https://azuka.github.io/posts/post1/newrelic-breakdown-2.png" alt="Newrelic APM Stats">&lt;/p>&lt;p>And that, friends, is one way to run a local APM for PHP.&lt;/p></description></item></channel></rss>